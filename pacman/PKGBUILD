pkgname=asimov-cli
pkgver=25.0.0_dev.2
pkgrel=1
pkgdesc="Asimov CLI Tool"
arch=('x86_64' 'aarch64')
url="https://github.com/asimov-platform/asimov-cli"
license=('MIT')
depends=()

# Correct filenames for GitHub release
source_x86_64=("https://github.com/asimov-platform/asimov-cli/releases/download/25.0.0-dev.2/asimov-linux-x86.gz")
source_aarch64=("https://github.com/asimov-platform/asimov-cli/releases/download/25.0.0-dev.2/asimov-linux-arm.gz")

sha256sums_x86_64=("a64251f846d0cc0280a7f83f25f0db0c4f15ef4caf349ccd45dad22250866060")
sha256sums_aarch64=("e9ca2393fe6147a01f10a36bd162b8f014fcfc1e964bb65a33e6d0920b34960d")

package() {
    cd "$srcdir"

    # Determine the correct filename based on architecture
    if [[ "$CARCH" == "x86_64" ]]; then
        source_file="asimov-linux-x86.gz"
    else
        source_file="asimov-linux-arm.gz"
    fi

    # Debugging: List directory contents
    echo "Contents of $srcdir:"
    ls -lah

    # Check if file exists
    if [[ ! -f "$source_file" ]]; then
        echo "Error: Expected file $source_file not found!"
        exit 1
    fi

    # Verify it's a valid gzip file before extracting
    if ! file "$source_file" | grep -q "gzip compressed data"; then
        echo "Error: $source_file is not a valid gzip file!"
        exit 1
    fi

    # Decompress the binary
    gunzip "$source_file"

    # Extracted filename (remove .gz)
    extracted_file="${source_file%.gz}"

    # Make executable
    chmod +x "$extracted_file"

    # Install into /usr/bin/
    install -Dm755 "$extracted_file" "$pkgdir/usr/bin/asimov"
}
